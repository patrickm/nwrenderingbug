<!DOCTYPE html>
<html>
<head>
	<title>NW Fonts Rendering Bug</title>
	<meta charset="utf-8">
	
	<link rel="stylesheet" type="text/css" href="/fonts.css">
	<link rel="stylesheet" type="text/css" href="/main.css">
	<script type="text/javascript">
	document.addEventListener("DOMContentLoaded", function(event) {
		var runTest = function(windowFile) {
			document.querySelector('div.intro').style.display = 'none';
			document.querySelector('div.outro').style.display = 'block';
			nw.Window.open('/' + windowFile + '.html', {frame:false}, function(appWin) {
				setTimeout(function() {
					if (appWin) {
						appWin.close();
					}
					[].forEach.call(document.querySelectorAll('div.test p'), function(el) {
						el.style.display = 'block';
					});
				}, 500);
			});
		};
		
		document.querySelector('a.start-test-fail').addEventListener('click', function(evt) {
			evt.preventDefault();
			runTest('window-fail');
		});
		document.querySelector('a.start-test-pass').addEventListener('click', function(evt) {
			evt.preventDefault();
			runTest('window-pass');
		});
		document.querySelector('a.restart').addEventListener('click', function(evt) {
			evt.preventDefault();
			chrome.runtime.reload();
		});
	});
	</script>
</head>
<body>
	<article>
		<h2>NW Fonts Rendering Bug</h2>
		<div class="intro">
			<ol>
				<li>In red boxes white text should be visible with custom font.</li>
				<li>Tests 1 and 3 display that text right away, where tests 2 and 4 display it after opening a frameless window</li>
				<li>If you open a frameless window with the same css (with fonts) used for this page red box text in TEST 2 won't be visible</li>
				<li>To fail (not display text) custom font needs to be set on some element that's visible before opening frameless window (font-size must match too)</li>
				<li>The only thing we're doing here is:
					<ol>
						<li>main page: load fonts.css, add custom font-family to some element that's visible, open frameless window</li>
						<li>frameless window: load fonts.css</li>
						<li>main page: unhide/add-new element with the same custom font</li>
					</ol>
				</li>
			</ol>
			<a href="#" class="start-test-fail">Start Test (should fail - same css)</a>  |  
			<a href="#" class="start-test-pass">Start Test (should pass - other css)</a>
		</div>
		<div class="outro" style="display: none">
			<p>Check if text in red box is visible for TEST 2</p>
			<a href="#" class="restart">Restart</a>
		</div>
	</article>

	<div class="test test-1">
		<h1>Test 1 (font-size: 12px)</h1>
		<p>Lorem ipsum..</p>
	</div>

	<div class="test test-2">
		<h1>Test 2 (font-size: 12px)</h1>
		<p>Lorem ipsum..</p>
	</div>

	<div class="test test-3">
		<h1>Test 3 (font-size: 16px)</h1>
		<p>Lorem ipsum..</p>
	</div>

	<div class="test test-4">
		<h1>Test 4 (font-size: 16px)</h1>
		<p>Lorem ipsum..</p>
	</div>
</div>
</body>
</html>
